# 心理测评问卷系统数据库设计

## 📋 项目需求分析

### **业务需求梳理**

#### **1. 用户管理需求**
```
用户类型：
├── 普通用户 (答题者)
├── 管理员 (系统管理)
├── 专家用户 (问卷设计)
└── 游客用户 (临时访问)

用户数据：
├── 基本信息 (姓名、年龄、性别等)
├── 登录凭证 (账号、密码、Token)
├── 个人档案 (教育背景、职业等)
└── 测评历史 (多次测评记录)
```

#### **2. 问卷系统需求**
```
问卷管理：
├── 问卷基本信息 (标题、描述、版本)
├── 题目管理 (题目内容、选项、类型)
├── 量表设置 (评分规则、权重配置)
└── 发布状态 (草稿、发布、停用)

题目特征：
├── 题目类型 (单选、多选、量表、开放题)
├── 心理维度映射 (对应的心理因子)
├── 权重系数 (对因子计算的贡献度)
└── 反向计分标记
```

#### **3. 答题数据需求**
```
答题会话：
├── 会话标识 (唯一ID、开始时间)
├── 答题进度 (当前题目、完成度)
├── 答题时长 (每题用时、总用时)
└── 完成状态 (进行中、已完成、中断)

答案记录：
├── 具体答案内容
├── 答题时间戳
├── 修改历史记录
└── 质量标记 (有效性、一致性)
```

#### **4. 分析结果需求**
```
因子得分：
├── 各个心理因子的计算得分
├── 标准化后的数值
├── 置信度区间
└── 计算版本追踪

风格评估：
├── 主导心理风格类型
├── 次要风格及占比
├── 风格强度评级
└── 个性化建议内容

分析报告：
├── 结构化分析结果
├── 可视化图表数据
├── 专业解读文本
└── 历史对比分析
```

#### **5. 系统管理需求**
```
配置管理：
├── 算法参数配置
├── 评分规则设置
├── 系统运行参数
└── 接口权限控制

日志审计：
├── 用户操作日志
├── 系统运行日志
├── 数据变更记录
└── 异常错误日志
```

## 🗂️ 数据库设计流程

### **第一阶段：概念设计**

#### **1. 实体识别**
```
核心实体：
├── User (用户)
├── Questionnaire (问卷)
├── Question (题目)
├── TestSession (测试会话)
├── Answer (答案)
├── PsychFactor (心理因子)
├── AnalysisResult (分析结果)
└── Report (报告)

辅助实体：
├── UserProfile (用户档案)
├── QuestionOption (题目选项)
├── FactorScore (因子得分)
├── StyleType (风格类型)
├── SystemConfig (系统配置)
└── AuditLog (审计日志)
```

#### **2. 关系识别**
```
主要关系：
├── User ←→ TestSession (一对多)
├── Questionnaire ←→ Question (一对多)
├── TestSession ←→ Answer (一对多)
├── Question ←→ PsychFactor (多对多)
├── TestSession ←→ AnalysisResult (一对一)
├── AnalysisResult ←→ FactorScore (一对多)
└── AnalysisResult ←→ Report (一对一)
```

### **第二阶段：逻辑设计**

#### **1. 集合结构设计 (MongoDB)**
```
核心集合：
├── users - 用户基本信息
├── questionnaires - 问卷定义
├── questions - 题目库
├── testSessions - 测试会话
├── answers - 答案记录
├── analysisResults - 分析结果
├── reports - 分析报告
└── systemConfigs - 系统配置

索引策略：
├── 复合索引：用户ID + 会话时间
├── 文本索引：问卷标题、题目内容
├── 稀疏索引：可选字段
└── TTL索引：临时数据过期
```

#### **2. 文档结构设计**
```
嵌套 vs 引用策略：
├── 嵌套：小型、静态、一起查询的数据
├── 引用：大型、动态、独立查询的数据
├── 混合：根据查询模式灵活选择
└── 版本控制：支持schema演化
```

### **第三阶段：物理设计**

#### **1. 性能优化策略**
```
查询优化：
├── 建立合适的索引
├── 使用聚合管道优化复杂查询
├── 实现查询结果缓存
└── 分页查询避免大数据集

存储优化：
├── 使用GridFS存储大文件
├── 压缩算法减少存储空间
├── 数据归档策略
└── 冷热数据分离
```

#### **2. 扩展性设计**
```
水平扩展：
├── 分片键选择策略
├── 读写分离架构
├── 副本集配置
└── 负载均衡设计

垂直扩展：
├── 硬件资源规划
├── 内存优化配置
├── 磁盘IO优化
└── 网络带宽规划
```

## 🎯 具体设计步骤指南

### **步骤1：需求细化分析**
```
任务清单：
□ 明确每个用户角色的数据访问需求
□ 列出所有业务流程涉及的数据操作
□ 确定数据的生命周期和访问模式
□ 分析数据量级和增长预期
□ 识别性能敏感的查询场景
```

### **步骤2：数据模型设计**
```
设计原则：
├── 根据查询模式设计文档结构
├── 平衡嵌套和引用的使用
├── 考虑数据一致性要求
├── 预留扩展字段和版本控制
└── 设计合理的索引策略
```

### **步骤3：集合详细设计**
```
每个集合需要定义：
├── 文档结构 (Schema)
├── 索引定义
├── 验证规则
├── 默认值设置
└── 业务约束
```

### **步骤4：关系和引用设计**
```
引用策略选择：
├── 一对一：嵌入 vs 引用
├── 一对多：嵌入数组 vs 分离集合
├── 多对多：中间集合 vs 数组引用
└── 级联操作：更新、删除策略
```

### **步骤5：性能和安全考虑**
```
性能优化：
├── 索引策略制定
├── 查询优化方案
├── 缓存策略设计
└── 数据分片规划

安全设计：
├── 用户权限控制
├── 数据加密策略
├── 审计日志设计
└── 备份恢复方案
```

## 🔧 设计工具和方法

### **建模工具推荐**
```
概念建模：
├── Draw.io - 免费在线画图
├── Lucidchart - 专业图表工具
├── MongoDB Compass - 可视化数据浏览
└── Studio 3T - MongoDB专业工具

文档管理：
├── 使用JSON Schema定义文档结构
├── 编写详细的API文档
├── 维护数据字典
└── 版本变更记录
```

### **验证方法**
```
设计验证：
├── 用典型业务场景验证设计
├── 性能测试验证索引效果
├── 数据一致性检查
└── 扩展性压力测试
```

## 📝 设计文档模板

### **建议的文档结构**
```
1. 项目概述
   - 业务背景
   - 技术栈选择
   - 设计目标

2. 需求分析
   - 功能需求
   - 非功能需求
   - 约束条件

3. 概念模型
   - 实体关系图
   - 业务流程图
   - 数据流图

4. 逻辑模型
   - 集合设计
   - 文档结构
   - 关系定义

5. 物理模型
   - 索引策略  
   - 性能优化
   - 部署架构

6. 实施计划
   - 开发阶段
   - 测试策略
   - 上线计划
```

---

现在您可以根据这个框架，结合您的具体需求来详细设计数据库。您希望从哪个部分开始深入设计？比如先详细分析用户管理的数据需求，还是先设计核心的问卷和答题数据结构？
